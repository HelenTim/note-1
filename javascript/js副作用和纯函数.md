## 什么是函数副作用？

[函数](http://www.fly63.com/tag/%E5%87%BD%E6%95%B0)副作用是指当调用函数时，除了返回函数值之外，还对主调用函数产生附加的影响。副作用的函数不仅仅只是返回了一个值，而且还做了其他的事情，比如：

- 修改了一个变量
- 直接修改数据结构
- 设置一个对象的成员
- 抛出一个异常或以一个错误终止
- 打印到终端或读取用户输入
- 读取或写入一个文件7、在屏幕上画图

js中要想保证函数无副作用这项特性，只能依靠编程人员的习惯，即

1，函数入口使用参数运算，而不修改它

2，函数内不修改函数外的变量，如全局变量

3，运算结果通过函数返回给外部（出口）

### **纯函数**

> 纯函数是这样一种函数，即相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。

**举例1：数组的两个方法：slice与splice。**

这两个函数的作用并无二致——但是注意，它们各自的方式却大不相同，但不管怎么说作用还是一样的。我们说 slice 符合纯函数的定义是因为对相同的输入它保证能返回相同的输出。而 splice 却会嚼烂调用它的那个数组，然后再吐出来；这就会产生可观察到的副作用，即这个数组永久地改变了。

```jsx
var	xs = [1,2,3,4,5];
var	xp = [1,2,3,4,5];
//纯的
xs.slice(0,3); //=>[1,2,3]
xs.slice(0,3); //=>[1,2,3]
xs.slice(0,3); //=>[1,2,3]
console.log(xs); //=>[1,2,3,4,5];//不纯的
xp.splice(0,3); //=>[1,2,3]
xp.splice(0,3); //=>[4,5]
xp.splice(0,3); //=>[]
console.log(xp); //=>[];
```

### **纯函数的例子**

以下是一个计算产品税后价格（英国税率是20%）的纯函数的例子：

```jsx
function priceAfterTax(productPrice) { 
	return (productPrice * 0.20) + productPrice;
}
```

它符合我们所说的两条纯函数的定义。不依赖于任何外部输入，不改变任何外部数据、没有副作用。

即使你用同样的输入运行运行这个函数 100,000,000 次它**依旧产生同样的结果**。

### **非纯函数**

我们已经看了纯函数的例子，现在一起来看一个非纯函数（Impure function）的 JavaScript 例子:

```jsx
var tax = 20;
function calculateTax(productPrice) {
    return (productPrice * (tax/100)) + productPrice;
}
```

暂停片刻，看看你是否能看出为什么这个函数不纯。

其中函数的计算结果取决于外部 tax 变量，而纯函数不能依赖外部变量。它没有满足定义中的第一个要求，因此这个函数是不纯的。

### **为什么说纯函数在 JavaScript 很重要？**

纯函数在函数式编程中被大量使用。而且诸如 [ReactJS](https://facebook.github.io/react/docs/components-and-props.html) 和 [Redux](http://redux.js.org/docs/introduction/ThreePrinciples.html) 等优质的库都需要使用纯函数。

不过，纯函数也可以用在平常的 JavaScript 开发中使用，不一定要限死在某个编程范例中。 你可以混合纯的和不纯的函数，这完全没问题。

并非所有函数都需要是纯的。 例如，操作 DOM 的按钮按下的事件处理程序就不适合纯函数。 不过，这种事件处理函数可以调用其他纯函数来处理，以此减少项目中不纯函数的数量。

### **可测试性和重构**

另一个使用纯函数的原因是测试以及重构。

使用纯函数的一个主要好处是它们可以直接测。 如果传入相同的参数，它们将始终产生相同的结果。

同时纯函数还使得维护和重构代码变得更加容易。你可以放心地重构一个纯函数，不必操心没注意到的副作用搞乱了整个应用而导致终调试地狱。（译注：如果项目中充斥着副作用，那么函数/模块之间的逻辑可能互相交织耦合，在后期新增逻辑时可能由于依赖复杂而难以重构，更常见的是开发为了应付需求而不断的引入新的副作用到原本的逻辑上从而导致代码变得越来越糟糕。）

正确地使用纯函数可以产生更加高质量的代码。并且也是一种更加干净的编码方式。
